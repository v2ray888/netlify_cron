# 用户设置功能说明文档

## 功能概述

本文档详细说明了自动化定时任务平台中新增的用户设置功能。该功能允许用户修改个人账户信息，包括邮箱地址和登录密码，采用左侧树型导航UI结构，提供直观易用的操作界面。

## 功能特点

1. **树型导航结构**：左侧导航栏采用树型结构，清晰展示可用的设置选项
2. **邮箱修改功能**：用户可以安全地更新账户绑定的邮箱地址
3. **密码修改功能**：用户可以修改登录密码，增强账户安全性
4. **表单验证**：所有输入都经过严格的前端和后端验证
5. **用户友好反馈**：操作结果通过清晰的消息提示展示给用户

## 技术实现

### 前端实现

用户设置功能的前端实现包含以下组件和页面：

1. **用户设置主页面** (`src/app/dashboard/settings/page.tsx`)
   - 负责用户认证检查和默认页面重定向

2. **用户设置布局组件** (`src/components/UserSettingsLayout.tsx`)
   - 实现左侧树型导航结构
   - 管理页面间的导航和状态

3. **个人信息设置页面** (`src/app/dashboard/settings/profile/page.tsx`)
   - 显示邮箱修改表单

4. **密码设置页面** (`src/app/dashboard/settings/password/page.tsx`)
   - 显示密码修改表单

5. **邮箱修改表单组件** (`src/components/ChangeEmailForm.tsx`)
   - 提供邮箱修改的用户界面和交互逻辑

6. **密码修改表单组件** (`src/components/ChangePasswordForm.tsx`)
   - 提供密码修改的用户界面和交互逻辑

### 后端实现

用户设置功能的后端API端点：

1. **修改邮箱API** (`src/app/api/user/email/route.ts`)
   - 使用PUT方法更新用户邮箱地址
   - 包含邮箱格式验证和唯一性检查
   - 防止邮箱地址冲突

2. **修改密码API** (`src/app/api/user/password/route.ts`)
   - 使用PUT方法更新用户密码
   - 包含当前密码验证和新密码强度检查
   - 使用bcryptjs进行密码加密存储

## 使用方法

### 访问用户设置页面

1. 用户登录系统后，在仪表板页面点击右上角的"设置"按钮
2. 系统将自动跳转到用户设置页面，默认显示个人信息设置

### 修改邮箱地址

1. 在左侧导航栏中点击"个人信息"选项
2. 在"当前邮箱地址"字段中查看当前绑定的邮箱
3. 在"新邮箱地址"字段中输入新的邮箱地址
4. 点击"更新邮箱地址"按钮
5. 系统将验证邮箱格式和唯一性，操作结果会通过消息提示展示

### 修改登录密码

1. 在左侧导航栏中点击"修改密码"选项
2. 在"当前密码"字段中输入当前登录密码
3. 在"新密码"字段中输入新密码（至少6位）
4. 在"确认新密码"字段中再次输入新密码
5. 点击"更新密码"按钮
6. 系统将验证当前密码正确性和新密码一致性，操作结果会通过消息提示展示

## 安全措施

1. **身份验证**：所有设置操作必须在用户登录状态下进行
2. **权限控制**：用户只能修改自己的账户信息
3. **数据验证**：
   - 邮箱格式验证
   - 邮箱唯一性检查
   - 密码长度验证（至少6位）
   - 密码确认匹配验证
4. **密码加密**：使用bcryptjs对密码进行加密存储
5. **HTTPS传输**：所有数据通过加密通道传输

## 错误处理

系统提供了完善的错误处理机制：

### 前端错误处理
- 表单输入验证错误
- 网络请求错误
- 服务器响应错误
- 用户操作反馈提示

### 后端错误处理
- 身份验证失败（401）
- 数据验证失败（400）
- 用户不存在（404）
- 服务器内部错误（500）
- 数据冲突错误（400）

所有错误信息都会通过清晰的消息提示展示给用户。

## UI设计规范

1. **树型导航结构**：左侧导航栏采用垂直树型结构，清晰展示设置选项
2. **响应式设计**：适配不同屏幕尺寸，移动端自动调整为垂直布局
3. **视觉反馈**：当前选中项有明显的视觉标识（背景色和左侧边框）
4. **操作状态**：按钮在加载过程中显示加载动画
5. **消息提示**：成功和错误消息使用不同颜色区分

## 注意事项

1. 修改邮箱后，建议使用新邮箱进行登录
2. 修改密码后，旧密码将立即失效
3. 密码长度至少为6位字符
4. 新邮箱地址不能与其他用户冲突
5. 所有操作需要网络连接，网络异常时可能无法完成操作

## 相关文件

- `src/app/dashboard/settings/page.tsx`：用户设置主页面
- `src/app/dashboard/settings/profile/page.tsx`：个人信息设置页面
- `src/app/dashboard/settings/password/page.tsx`：密码设置页面
- `src/components/UserSettingsLayout.tsx`：用户设置布局组件
- `src/components/ChangeEmailForm.tsx`：邮箱修改表单组件
- `src/components/ChangePasswordForm.tsx`：密码修改表单组件
- `src/app/api/user/email/route.ts`：修改邮箱API端点
- `src/app/api/user/password/route.ts`：修改密码API端点

## 版本信息

此功能已在系统中完整实现并可正常使用。